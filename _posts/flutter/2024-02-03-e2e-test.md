---
published: false
title: "[Flutter] E2E Test 적용해보기"
excerpt: " "
layout: single
classes: wide
author_profile: true
read_time: false # read_time을 출력할지 여부 1min read 같은것!
toc: true #Table Of Contents 목차 보여줌
toc_label: "My Table of Contents" # toc 이름 정의
toc_icon: "cog" #font Awesome아이콘으로 toc 아이콘 설정
toc_sticky: true # 스크롤 내릴때 같이 내려가는 목차
categories:
  - Flutter
tags:
  - Flutter
  - Dart
comments: true
header:
  overlay_image: assets/images/flutter_banner.jpeg
  overlay_filter: 0.4
  teaser:
sitemap:
  changefreq: daily
  priority: 1.0
---

<div align="center">
<img width="982" alt="image" src="https://user-images.githubusercontent.com/35194820/211177673-7ec90307-162d-4696-89b3-6054415d2db5.png">
</div>

## Overview

위 포스트에서는 Flutter E2E 자동화 테스트를 적용해보는 내용에 대해서 다루고 있습니다.

## 1. E2E(End to End) Test 란?

E2E(End-to-End) 테스트는 앱의 전체적인 품질과 기능을 보장하는 데 중요한 역할을 합니다. 이 테스트는 실제 단말기(예: Android 또는 iOS 폰)와 실제 서버(예: Firebase)를 사용하여 완전한 프로덕션 환경을 시뮬레이션합니다. 여기서 하나의 'End'는 단말기를, 다른 하나의 'End'는 서버를 의미합니다.

전통적으로 QA 팀이 수행하는 E2E 테스트는 실제 단말기를 조작하고 서버와 통신하여 결과를 직접 확인하는 과정을 포함합니다. 이러한 접근법은 실제 사용자 시나리오를 모방하여 앱이 실제 조건에서 예상대로 작동하는지를 확인하는 것을 목표로 합니다. 하지만, 이 수동 접근 방식은 시간이 많이 걸리고 인간의 오류로 인해 테스트 결과에 일관성이 없을 수 있는 단점이 있습니다.

이러한 도전을 극복하기 위해, E2E 테스트의 자동화가 필수적이 되었습니다. 자동화는 시간을 절약할 뿐만 아니라 인간의 오류 가능성을 크게 줄여줍니다. 자동화된 E2E 테스트는 일정에 따라 일관되게 실행되어 신뢰할 수 있고 반복 가능한 결과를 제공합니다. 이는 지속적인 통합 및 배포 파이프라인에서 매우 중요한 도구가 되어, 사용자들이 오늘날 요구하는 높은 품질과 신뢰성 기준을 각 릴리스가 충족하도록 보장합니다.

Flutter에서는 **`integration_test`** 패키지를 사용하여 E2E 테스트를 자동화할 수 있습니다. 개발자들은 사용자 인터페이스와 백엔드 서비스와 상호작용하는 테스트를 작성할 수 있으며, 이 접근법은 앱의 모든 측면이 실제 조건에서 올바르게 기능하는지를 보장합니다.

### E2E 자동화 Test 한계점

- 매우 복잡한 시나리오인 경우 테스트 코드 자체를 작성하는 것이 실제 개발하는 것보다 더 어렵고 시간이 오래 걸릴수가 있습니다.
- 다양한 예외처리 (예를 들어 서버가 실패하는 시나리오) 를 검증하기 어렵습니다.

### E2E 자동화 Test를 적용해야 하는 타겟

앱의 모든 기능에 대해서 E2E 자동화 테스트를 적용하는 것은 현실적으로 어려울 수 있습니다. 따라서, E2E 자동화 테스트를 적용할 때에는 다음과 같은 기준을 고려하여 적용하는 것이 좋습니다.

- 중대한 핵심 기능: E2E 테스트는 시스템의 가장 중요하고 핵심적인 기능들, 특히 실패 시 심각한 결과를 초래할 수 있는 기능들에 초점을 맞춰야 합니다. 이러한 기능들은 시스템의 안정성과 사용자 경험에 직접적인 영향을 미치기 때문에, 신중하게 테스트되어야 합니다.
- 개발 완료 및 UI 변경 가능성이 낮은 기능: 개발이 완전히 마무리된 기능들, 특히 추후에 UI 시나리오나 기능 자체에 대한 변경 가능성이 낮은 기능들은 E2E 테스트의 이상적인 대상입니다. 이러한 기능들은 테스트 스크립트를 자주 수정할 필요가 없어, 테스트의 유지 관리 부담을 줄일 수 있습니다.

## 2. Flutter 에 E2E Test 적용하기

먼저 아래 간단한 예제를 통해서 E2E Test 를 적용해보겠습니다.

### Sample App 소개 및 코드

아래 플로팅 버튼을 누르면 카운터가 증가하는 간단한 앱을 예제로 사용하겠습니다.

<img width="408" alt="image" src="https://github.com/Origogi/leetcode/assets/35194820/d4ca6b4c-ec18-4700-8e79-ba37206fe10c">

<details>
<summary>Dart Code</summary>

```dart
import 'package:flutter/material.dart';

void main() => runApp(const MyApp());

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return const MaterialApp(
      title: 'Counter App',
      home: MyHomePage(title: 'Counter App Home Page'),
    );
  }
}

class MyHomePage extends StatefulWidget {
  const MyHomePage({super.key, required this.title});

  final String title;

  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            const Text(
              'You have pushed the button this many times:',
            ),
            Text(
              '$_counter',
              style: Theme.of(context).textTheme.headlineMedium,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        // Provide a Key to this button. This allows finding this
        // specific button inside the test suite, and tapping it.
        key: const Key('increment'),
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: const Icon(Icons.add),
      ),
    );
  }
}
```
</details>

### integrate test 패키지 추가

```yaml
dev_dependencies:
  flutter_test:
    sdk: flutter
  integration_test:
    sdk: flutter
```

### Sample App E2E Test 코드

해당 앱에 대한 E2E Test 코드는 아래와 같습니다.


<details>
<summary>Dart Code</summary>

```dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:introduction/main.dart';

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized(); // 테스트 코드의 최상단에 해당 코드를 호출합니다.

  group('end-to-end test', () {
    testWidgets('tap on the floating action button, verify counter',
        (tester) async {
      // 최상위 위젯을 로드 합니다.
      await tester.pumpWidget(const MyApp());

      // 첫 화면에서 텍스트 0을 찾습니다.
      expect(find.text('0'), findsOneWidget);

      // 플로팅 액션 버튼을 찾습니다. 여기서 Key 값은 위젯의 Key 값과 동일해야 합니다.
      final fab = find.byKey(const Key('increment'));

      // 플로팅 액션 버튼을 탭합니다.
      await tester.tap(fab);

      // 화면을 갱신합니다.
      await tester.pumpAndSettle();

      // 텍스트 1을 찾습니다.
      expect(find.text('1'), findsOneWidget);
    });
  });
}
```
</details>

### E2E Test 실행

아래 명령어를 수행하면 현재 컴퓨터에 연결된 디바이스나 에뮬레이터에서 E2E Test 가 실행됩니다.

```bash
flutter test integration_test/app_test.dart
```

## Flutter `integration_test` 패키지 설명

flutter integration test 를 이해하기 위해서는 아래 `Tester`, `Finder`, `Assertion` 에 대한 이해가 필요합니다.

### Tester

Flutter에서의 테스트 과정을 이해하는 데 있어, 실제 사용자나 테스터가 단말기를 조작하는 행위를 모방하는 것이 핵심입니다. 이를 위해 Flutter 테스트 프레임워크는 사용자의 상호작용을 재현할 수 있는 `Teseter` 를 제공합니다. 특히, `화면 탭(tap)`, `화면 스크롤(scroll)`, `텍스트 입력(TextField)` 과 같은 기본적인 사용자 상호작용을 시뮬레이션할 수 있는 API들이 포함되어 있습니다.

또한, Flutter 테스트에서는 위젯의 상태 변화와 애니메이션 처리를 위한 중요한 API들이 제공됩니다:

- `pumpWidget()` 은 테스트 환경에서 특정 위젯을 초기화하고 렌더링하는 데 사용됩니다. 이는 앱이 시작될 때 runApp()에 의해 실행되는 주 위젯을 설정하는 과정과 유사합니다. 이 메서드를 통해, 테스트하고자 하는 위젯을 테스트 트리의 루트로 설정할 수 있습니다.
- `pump()` 는 위젯 트리에 단일 프레임을 트리거하는 데 사용되며, 선택적으로 특정 시간 동안 대기할 수 있습니다. 예를 들어, pump(Duration(seconds: 1))을 호출하면, 위젯 트리가 업데이트되고 1초 동안 대기한 후 다음 코드 라인이 실행됩니다. 이는 애니메이션 진행이나 UI 변화가 한 단계씩 진행될 때 유용합니다.
- `pumpAndSettle()` : 애니메이션과 같은 비동기 작업들이 완료될 때까지 여러 번 프레임을 트리거합니다. 이는 애니메이션이나 다른 비동기 이벤트들이 완료되고 위젯 트리가 안정화될 때까지 반복적으로 프레임을 생성합니다. 기본적으로, 이 메서드는 100ms 간격으로 프레임을 생성하며, 최대 300번 시도한 후에 멈춥니다. 애니메이션이나 비동기 이벤트들이 모두 완료될 때까지 기다리는 상황에서 매우 유용합니다.

요약하면, pump는 특정 시간 동안 대기하거나 단일 프레임을 생성하는 데 사용되며, pumpAndSettle 은 모든 애니메이션과 비동기 작업들이 완료될 때까지 여러 프레임을 생성하여 위젯 트리가 안정화되는 것을 보장하는 데 사용됩니다. 이러한 도구들을 통해, 개발자들은 Flutter 앱의 다양한 상호작용과 동작을 효과적으로 테스트할 수 있습니다.

### Finder

Flutter 테스트에서 **`find`**는 위젯을 찾는 데 사용되는 다양한 방법들을 제공합니다. **`find`**를 통해 테스트하려는 위젯을 정확하게 식별하고 검증할 수 있습니다. 다음은 몇 가지 일반적인 위젯 찾기 방법들입니다:

1. **텍스트로 찾기**: **`find.text`**를 사용하여 특정 텍스트를 포함하는 **`Text`** 위젯을 찾습니다. 예를 들어, **`find.text('Hello')`**는 화면에 'Hello'라는 텍스트를 포함하는 모든 위젯을 찾습니다.
2. **키로 찾기**: **`find.byKey`**를 사용하여 특정 **`Key`**를 가진 위젯을 찾습니다. 예를 들어, **`find.byKey(Key('uniqueKey'))`**는 'uniqueKey'라는 키를 가진 위젯을 찾습니다.
3. **타입으로 찾기**: **`find.byType`**를 사용하여 특정 타입의 위젯을 찾습니다. 예를 들어, **`find.byType(IconButton)`**는 모든 **`IconButton`** 위젯을 찾습니다.
4. **아이콘으로 찾기**: **`find.byIcon`**을 사용하여 특정 아이콘을 가진 **`Icon`** 위젯을 찾습니다. 예를 들어, **`find.byIcon(Icons.add)`**는 'add' 아이콘을 가진 위젯을 찾습니다.
5. **위젯 특성으로 찾기**: **`find.byWidgetPredicate`**를 사용하여 특정 조건을 만족하는 위젯을 찾습니다. 예를 들어, 특정 위젯이 **`Container`**이고 특정 색상을 가지는지 확인할 수 있습니다.
6. **애니메이션으로 찾기**: **`find.byAnimation`**을 사용하여 특정 **`Animation`**을 가진 위젯을 찾습니다. 예를 들어, 특정 애니메이션 컨트롤러를 사용하는 위젯을 찾을 수 있습니다.
7. **조건을 충족하는 첫 번째/마지막 위젯 찾기**: **`find.first`**나 **`find.last`**를 사용하여 조건을 충족하는 첫 번째나 마지막 위젯을 찾습니다.

이러한 방법들은 위젯 테스트에서 매우 유용하며, 테스트하려는 위젯의 특성에 따라 적절한 방법을 선택할 수 있습니다. **`find`**를 통해 위젯을 정확하게 식별하고, 테스트 케이스에서 해당 위젯의 존재, 속성, 동작 등을 검증할 수 있습니다.

### Assertion

Flutter 테스트 프레임워크에서는 다양한 종류의 assertion을 제공합니다. 이들은 테스트 중에 특정 조건이 충족되는지 확인하는 데 사용됩니다. 여기 몇 가지 자주 사용되는 assertion들을 소개합니다:

1. **findsOneWidget**: **`expect`** 함수와 함께 사용될 때, 이 assertion은 정확히 하나의 위젯이 찾아지기를 기대합니다. 예를 들어, **`expect(find.text('Hello'), findsOneWidget);`**은 'Hello'라는 텍스트를 포함하는 위젯이 정확히 하나만 존재해야 함을 검증합니다.
2. **findsNothing**: 이 assertion은 주어진 조건을 만족하는 위젯이 하나도 없어야 함을 검증합니다. 예를 들어, **`expect(find.text('Goodbye'), findsNothing);`**은 'Goodbye'라는 텍스트를 포함하는 위젯이 없어야 함을 의미합니다.
3. **findsWidgets**: 이 assertion은 하나 이상의 위젯이 찾아지기를 기대합니다. 예를 들어, **`expect(find.byType(TextButton), findsWidgets);`**는 하나 이상의 **`TextButton`** 위젯이 존재해야 함을 검증합니다.
4. **findsNWidgets**: 특정 수의 위젯이 찾아지기를 기대합니다. 예를 들어, **`expect(find.byIcon(Icons.add), findsNWidgets(3));`**는 'add' 아이콘을 가진 위젯이 정확히 세 개 존재해야 함을 의미합니다.

이러한 assertion들은 Flutter 위젯 테스트에서 매우 중요하며, 테스트 케이스의 성공 여부를 결정짓는 데 사용됩니다. 테스트 중에 위젯의 존재 여부, 수, 속성, 상태 등을 검증하는 데 이러한 assertion들이 유용하게 사용됩니다.